---
title: "tea_coffee"
author: "Tim"
date: "2024-07-30"
output: html_document
---

```{r}
library(dplyr)
#main effects test for tea_coffee data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')
# Fit the model
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)
df$EID <- as.factor(df$EID)
results <- data.frame()
# List of variables to test
test_vars <- c("FilterCoffee_mean", "StandTea_mean")

dependent_vars <- c("rsfMRI_Component7", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component14", "rsfMRI_Component21")

# Double loop through each dependent and test variable and fit the model
for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
  
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)
    
   # Get the summary
    model_summary <- summary(model)
    
    # Extract the results for the test variable
    estimate <- model_summary$coefficients[test_var, "Estimate"]
    std_error <- model_summary$coefficients[test_var, "Std. Error"]
    p_value <- model_summary$coefficients[test_var, "Pr(>|t|)"]
    
    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         p_value = p_value))
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\tea_coffee\\results\\maineffect.csv",na='',row.names=FALSE)
rm(list=ls())
```
```{r}
#interaction test for tea coffee data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("FilterCoffee_mean", "StandTea_mean", "rsfMRI_Component7", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component14", "rsfMRI_Component21")

for (var in scale_vars) {
  df[[var]] <- as.numeric(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component7", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component14", "rsfMRI_Component21")

# List of variables to test
test_vars <- c("FilterCoffee_mean", "StandTea_mean")

# List of factors
factor_vars <- c("APOE_all", "T40_Gcar", "family_history_AD")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +",test_var,"+", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

 # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\tea_coffee\\results\\interactions.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#interaction test for tea coffee data with age
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\updated\\food_continuous.csv')
df$Age_2groups <- ifelse(df$Age_Baseline > 55, 1, 0)
# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component2",	"rsfMRI_Component3", "rsfMRI_Component4","rsfMRI_Component5", "rsfMRI_Component6", "rsfMRI_Component7", "rsfMRI_Component8", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component15", "rsfMRI_Component16", "rsfMRI_Component17",	"rsfMRI_Component18",	"rsfMRI_Component19", "rsfMRI_Component20", "rsfMRI_Component21", "Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- as.numeric(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component2",	"rsfMRI_Component3", "rsfMRI_Component4","rsfMRI_Component5", "rsfMRI_Component6", "rsfMRI_Component7", "rsfMRI_Component8", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component15", "rsfMRI_Component16", "rsfMRI_Component17",	"rsfMRI_Component18",	"rsfMRI_Component19", "rsfMRI_Component20", "rsfMRI_Component21")

# List of variables to test
test_vars <- c("VB6_mean", "VB12_mean", "Folate_mean")

# List of factors
factor_vars <- c("APOE_all", "Age_2groups", "family_history_AD", "Sex")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + Age_2groups + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +",test_var,"+", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

 # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\VBs\\results\\interactions_VBs_ages.csv",na='',row.names=FALSE)
rm(list=ls())
```