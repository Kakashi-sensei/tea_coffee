---
title: "tea_coffee"
author: "Tim"
date: "2024-07-30"
output: html_document
---

```{r}
library(dplyr)
#main effects test for tea_coffee data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')
# Fit the model
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)
df$EID <- as.factor(df$EID)
results <- data.frame()
# List of variables to test
test_vars <- c("FilterCoffee_mean", "StandTea_mean", "GreenTea_mean")

dependent_vars <- c("rsfMRI_Component4", "rsfMRI_Component7","rsfMRI_Component8", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component14", "rsfMRI_Component21")

# Double loop through each dependent and test variable and fit the model
for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
  
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)
    
   # Get the summary
    model_summary <- summary(model)
    
    # Extract the results for the test variable
    estimate <- model_summary$coefficients[test_var, "Estimate"]
    std_error <- model_summary$coefficients[test_var, "Std. Error"]
    p_value <- model_summary$coefficients[test_var, "Pr(>|t|)"]
    
    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         p_value = p_value))
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\tea_coffee\\results\\maineffect.csv",na='',row.names=FALSE)
rm(list=ls())
```
```{r}
#interaction test for tea coffee data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("GreenTea_mean", "FilterCoffee_mean", "StandTea_mean","rsfMRI_Component4","rsfMRI_Component7",
                "rsfMRI_Component8", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component14", "rsfMRI_Component21")

for (var in scale_vars) {
  df[[var]] <- as.numeric(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component4","rsfMRI_Component7","rsfMRI_Component8", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component14", "rsfMRI_Component21")

# List of variables to test
test_vars <- c("FilterCoffee_mean", "StandTea_mean", "GreenTea_mean")

# List of factors
factor_vars <- c("APOE_all", "T40_Gcar", "family_history_AD")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +",test_var,"+", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

 # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\tea_coffee\\results\\interactions.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#interaction test for tea coffee data with age
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')
df$Age_2groups <- ifelse(df$Age_Baseline > 55, 1, 0)
# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("FilterCoffee_mean", "StandTea_mean", "rsfMRI_Component7", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component14", "rsfMRI_Component21")

for (var in scale_vars) {
  df[[var]] <- as.numeric(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component7", "rsfMRI_Component11", "rsfMRI_Component12", "rsfMRI_Component14", "rsfMRI_Component21")

# List of variables to test
test_vars <- c("FilterCoffee_mean", "StandTea_mean")

# List of factors
factor_vars <- c("APOE_all", "Age_2groups", "family_history_AD", "Sex")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + Age_2groups + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +",test_var,"+", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

 # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\tea_coffee\\results\\interactions_ages.csv",na='',row.names=FALSE)
rm(list=ls())
```


```{r}
# making images
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font
# maineffects images
# IC4,8 with green tea
# IC 4 first
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

selected_vars <- df[c("GreenTea_mean", "rsfMRI_Component4", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("GreenTea_mean", "rsfMRI_Component4", "Age_Baseline", "BMI_Y08andY12andY14_mean")

# Fit the model for rsfMRI_Component21
formula <- as.formula("rsfMRI_Component4 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + GreenTea_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component21 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Extrastriate Visual Network (IC4)"
p <- ggplot(df_clean, aes(x = StandTea_mean, y = predicted_rsFMRI_Component21)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Green Tea Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_Gtea_rsFMRI_Component4.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all objects except for 'df'
rm(list = setdiff(ls(), "df"))

#IC8 next
selected_vars <- df[c("GreenTea_mean", "rsfMRI_Component8", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("GreenTea_mean", "rsfMRI_Component8", "BMI_Y08andY12andY14_mean", "Age_Baseline")

# Fit the model for rsfMRI_Component7
formula <- as.formula("rsfMRI_Component8 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + GreenTea_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component7 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Primary Visual Network (IC8)"
p <- ggplot(df_clean, aes(x = StandTea_mean, y = predicted_rsFMRI_Component7)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Green Tea Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_Gtea_rsFMRI_Component8.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

rm(list=ls())

# IC7,14,21 with tea
# IC 21 first
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

selected_vars <- df[c("StandTea_mean", "rsfMRI_Component21", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("StandTea_mean", "rsfMRI_Component21", "Age_Baseline", "BMI_Y08andY12andY14_mean")

# Fit the model for rsfMRI_Component21
formula <- as.formula("rsfMRI_Component21 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + StandTea_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component21 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Prefrontal and ‘What’ Pathway Network (IC21)"
p <- ggplot(df_clean, aes(x = StandTea_mean, y = predicted_rsFMRI_Component21)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Tea Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_tea_rsFMRI_Component21.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all objects except for 'df'
rm(list = setdiff(ls(), "df"))

#IC7 next
selected_vars <- df[c("StandTea_mean", "rsfMRI_Component7", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("StandTea_mean", "rsfMRI_Component7", "BMI_Y08andY12andY14_mean", "Age_Baseline")

# Fit the model for rsfMRI_Component7
formula <- as.formula("rsfMRI_Component7 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + StandTea_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component7 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Memory Consolidation Network (IC7)"
p <- ggplot(df_clean, aes(x = StandTea_mean, y = predicted_rsFMRI_Component7)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Tea Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_tea_rsFMRI_Component7.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all objects except for 'df'
rm(list = setdiff(ls(), "df"))

# IC 11 next
selected_vars <- df[c("StandTea_mean", "rsfMRI_Component11", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("FilterCoffee_mean", "StandTea_mean", "rsfMRI_Component11", "BMI_Y08andY12andY14_mean", "Age_Baseline")

# Fit the model for rsfMRI_Component11
formula <- as.formula("rsfMRI_Component11 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + StandTea_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component11 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Motor Execution Network (IC11)"
p <- ggplot(df_clean, aes(x = StandTea_mean, y = predicted_rsFMRI_Component11)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Tea Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_tea_rsFMRI_Component11.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all objects except for 'df'
rm(list = setdiff(ls(), "df"))

# IC 14 next
selected_vars <- df[c("StandTea_mean", "rsfMRI_Component14", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("StandTea_mean", "rsfMRI_Component14", "Age_Baseline", "BMI_Y08andY12andY14_mean")

# Fit the model for rsfMRI_Component14
formula <- as.formula("rsfMRI_Component14 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + StandTea_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component14 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Fronto-Cingular Network (IC14)"
p <- ggplot(df_clean, aes(x = StandTea_mean, y = predicted_rsFMRI_Component14)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Tea Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_tea_rsFMRI_Component14.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all objects except for 'df'
rm(list = setdiff(ls(), "df"))

# main effect of IC11, 12, 14, 21 with coffee
# IC21 first

selected_vars <- df[c("FilterCoffee_mean", "rsfMRI_Component21", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("FilterCoffee_mean", "rsfMRI_Component21", "BMI_Y08andY12andY14_mean", "Age_Baseline")

# Fit the model for rsfMRI_Component21
formula <- as.formula("rsfMRI_Component21 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + FilterCoffee_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component21 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Prefrontal and ‘What’ Pathway Network (IC21)"
p <- ggplot(df_clean, aes(x = FilterCoffee_mean, y = predicted_rsFMRI_Component21)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Coffee Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_coffee_rsFMRI_Component21.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all objects except for 'df'
rm(list = setdiff(ls(), "df"))

# IC 11 next

selected_vars <- df[c("FilterCoffee_mean", "rsfMRI_Component11", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("FilterCoffee_mean", "rsfMRI_Component11", "BMI_Y08andY12andY14_mean", "Age_Baseline")

# Fit the model for rsfMRI_Component11
formula <- as.formula("rsfMRI_Component11 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + FilterCoffee_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component11 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Motor Execution Network (IC11)"
p <- ggplot(df_clean, aes(x = FilterCoffee_mean, y = predicted_rsFMRI_Component11)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Coffee Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_coffee_rsFMRI_Component11.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all objects except for 'df'
rm(list = setdiff(ls(), "df"))

# IC 12 Next

selected_vars <- df[c("FilterCoffee_mean", "rsfMRI_Component12", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("FilterCoffee_mean", "rsfMRI_Component12", "BMI_Y08andY12andY14_mean", "Age_Baseline")

# Fit the model for rsfMRI_Component12
formula <- as.formula("rsfMRI_Component12 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + FilterCoffee_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component12 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Sensorimotor Network (IC12)"
p <- ggplot(df_clean, aes(x = FilterCoffee_mean, y = predicted_rsFMRI_Component12)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Coffee Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_coffee_rsFMRI_Component12.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all objects except for 'df'
rm(list = setdiff(ls(), "df"))


# IC 14 Next

selected_vars <- df[c("FilterCoffee_mean", "rsfMRI_Component14", "APOE_all", "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "BMI_Y08andY12andY14_mean" , "AlcoholY08" , "SmokingY08", "Townsend", "Assessment_0")]
df_clean <- df[complete.cases(selected_vars), ]

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df_clean[[var]] <- as.factor(df_clean[[var]])
}
rm(factor_vars,var)

rm(selected_vars)
# Scale all continuous variables
scale_vars <- c("FilterCoffee_mean", "rsfMRI_Component14", "BMI_Y08andY12andY14_mean", "Age_Baseline")

# Fit the model for rsfMRI_Component14
formula <- as.formula("rsfMRI_Component14 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + FilterCoffee_mean + (1 | Assessment_0)")
model_rsFMRI <- lmer(formula, data = df_clean, REML = FALSE)

# Generate predicted values
model_rows <- complete.cases(model.frame(model_rsFMRI))
predicted_values_rsFMRI <- rep(NA, nrow(df_clean))
predicted_values_rsFMRI[model_rows] <- predict(model_rsFMRI, re.form = NA)

# Add predicted values to df_clean
df_clean$predicted_rsFMRI_Component14 <- predicted_values_rsFMRI

# Create the plot
plot_title <- "Fronto-Cingular Network (IC14)"
p <- ggplot(df_clean, aes(x = FilterCoffee_mean, y = predicted_rsFMRI_Component14)) +
    geom_point(shape = 21, size = 24, stroke = 2, colour = "black", fill = "gray") +
    geom_smooth(method = "lm", color = "black", size = 2, se = FALSE) +
    labs(
        title = plot_title,
        x = "Coffee Consumption (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)"
    ) +
    theme_minimal() +
    theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
    )

# Save the plot
file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/tea_coffee/figures/maineffects_coffee_rsFMRI_Component14.tiff"
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

# Remove all 
rm(list = ls())
```

```{r}
# interaction images
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font
# interaction images
# IC7, with Coffee on APOE4

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("FilterCoffee_mean", "rsfMRI_Component7","Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- as.numeric(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component7")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + FilterCoffee_mean + APOE_all:FilterCoffee_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$APOE_all), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component7") {
        plot_title <- "Memory Consolidation Network"
    }
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "FilterCoffee_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(APOE_all), fill = as.factor(APOE_all)), shape = 21, size = 24, stroke=2) +
      geom_smooth(data = subset(df_filtered, APOE_all == 0), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, APOE_all == 1), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Coffee Consumtion (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)",
        color = "APOE4 Status",
        fill = "APOE4 Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_coffee_APOE4_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())

# IC7 with Coffee on FH
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("rsfMRI_Component7", "FilterCoffee_mean","Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- as.numeric(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component7")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + FilterCoffee_mean + family_history_AD:FilterCoffee_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$family_history_AD), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component7") {
        plot_title <- "Memory Consolidation Network"
    }
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "FilterCoffee_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(family_history_AD), fill = as.factor(family_history_AD)), shape = 21, size = 24, stroke=2, data = subset(df_filtered, family_history_AD %in% c(0, 1))) +
      geom_smooth(data = subset(df_filtered, family_history_AD == 0), method = "lm", aes(color = as.factor(family_history_AD)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, family_history_AD == 1), method = "lm", aes(color = as.factor(family_history_AD)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Coffee Consumtion (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)",
        color = "Family History Status",
        fill = "Family History Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_coffee_fh_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())

# IC12, with Tea on APOE4

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("StandTea_mean", "rsfMRI_Component12","Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- as.numeric(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component12")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + StandTea_mean + APOE_all:StandTea_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$APOE_all), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component12") {
        plot_title <- "Sensorimotor Network "
    }
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "StandTea_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(APOE_all), fill = as.factor(APOE_all)), shape = 21, size = 24, stroke=2) +
      geom_smooth(data = subset(df_filtered, APOE_all == 0), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, APOE_all == 1), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Tea Consumtion (Cups/Mugs/250ml)",
        y = "Network Connectivity Strength (Z-score)",
        color = "APOE4 Status",
        fill = "APOE4 Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_tea_APOE4_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())
```

```{r}
#step 2 for interaction coffee
# Load libraries
library(lme4)
library(lmerTest)  # Provides p-values for fixed effects
library(dplyr)

# Load the dataset (replace 'your_dataset.csv' with your actual dataset)
df <- read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

# List of required columns for the analysis
required_columns_coffee <- c("rsfMRI_Component7", "rsfMRI_Component11", "rsfMRI_Component14", 
                             "rsfMRI_Component21", "rsfMRI_Component12", "Assessment_0", "APOE_all", 
                             "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "SmokingY08", 
                             "AlcoholY08", "BMI_Y08andY12andY14_mean", "Townsend", "FilterCoffee_mean")

# Ensure that the required columns exist in the dataset
missing_columns <- setdiff(required_columns_coffee, colnames(df))
if (length(missing_columns) > 0) {
    stop(paste("The following required columns are missing from the dataset:", paste(missing_columns, collapse = ", ")))
}

# Create a complete dataset by removing rows with NA in the required columns
df <- df[complete.cases(df[, required_columns_coffee]), ]

# Ensure that factors are treated correctly
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Assessment_0 <- as.factor(df$Assessment_0)  # For random effects

# List of rsfMRI components to loop through
rsfMRI_components <- c("rsfMRI_Component7", "rsfMRI_Component11", "rsfMRI_Component14", 
                       "rsfMRI_Component21", "rsfMRI_Component12")

# Initialize an empty data frame to store results
all_results_df <- data.frame()

### Loop 1: Testing by family_history_AD ###
for (component in rsfMRI_components) {
    # Check if the component exists in the dataset
    if (!component %in% colnames(df)) {
        warning(paste("Component", component, "is missing in the dataset. Skipping this component."))
        next
    }
  
    # Dynamically update the formula for each component
    formula <- as.formula(paste(component, "~ FilterCoffee_mean + (1 | Assessment_0)"))

    # Loop over family_history_AD
    for (family_history in unique(df$family_history_AD)) {
        # Subset the data for the current family_history_AD
        df_subset <- subset(df, family_history_AD == family_history)
        
        if (nrow(df_subset) > 0) {
            # Fit the mixed model
            model <- lmer(formula, data = df_subset, REML = FALSE)  # Use ML method
            summary_model <- summary(model)$coefficients
        } else {
            summary_model <- data.frame(Estimate = NA, `Std. Error` = NA, `Pr(>|t|)` = NA)
        }

        # Filter for "FilterCoffee_mean" term only (exclude intercept)
        summary_model <- summary_model[rownames(summary_model) == "FilterCoffee_mean", , drop = FALSE]

        # Create a data frame to store results for the current family_history_AD
        results_df <- data.frame(
            rsfMRI_Component = rep(component, nrow(summary_model)),
            Variable = "family_history_AD",
            Group = rep(family_history, nrow(summary_model)),
            Term = rownames(summary_model),
            Estimate = summary_model[, "Estimate"],
            Std_Error = summary_model[, "Std. Error"],
            p_value = summary_model[, "Pr(>|t|)"]
        )

        # Combine the current results with the overall results
        all_results_df <- rbind(all_results_df, results_df)
    }
}

### Loop 2: Testing by APOE_all ###
for (component in rsfMRI_components) {
    # Check if the component exists in the dataset
    if (!component %in% colnames(df)) {
        warning(paste("Component", component, "is missing in the dataset. Skipping this component."))
        next
    }
  
    # Dynamically update the formula for each component
    formula <- as.formula(paste(component, "~ FilterCoffee_mean + (1 | Assessment_0)"))

    # Loop over APOE_all
    for (APOE in unique(df$APOE_all)) {
        # Subset the data for the current APOE_all
        df_subset <- subset(df, APOE_all == APOE)
        
        if (nrow(df_subset) > 0) {
            # Fit the mixed model
            model <- lmer(formula, data = df_subset, REML = FALSE)  # Use ML method
            summary_model <- summary(model)$coefficients
        } else {
            summary_model <- data.frame(Estimate = NA, `Std. Error` = NA, `Pr(>|t|)` = NA)
        }

        # Filter for "FilterCoffee_mean" term only (exclude intercept)
        summary_model <- summary_model[rownames(summary_model) == "FilterCoffee_mean", , drop = FALSE]

        # Create a data frame to store results for the current APOE_all
        results_df <- data.frame(
            rsfMRI_Component = rep(component, nrow(summary_model)),
            Variable = "APOE_all",
            Group = rep(APOE, nrow(summary_model)),
            Term = rownames(summary_model),
            Estimate = summary_model[, "Estimate"],
            Std_Error = summary_model[, "Std. Error"],
            p_value = summary_model[, "Pr(>|t|)"]
        )

        # Combine the current results with the overall results
        all_results_df <- rbind(all_results_df, results_df)
    }
}

# Write the combined results to a CSV file
write.csv(all_results_df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\tea_coffee\\interactions_Coffee_all_components.csv", 
          na = '', row.names = FALSE)
rm(list = ls())
```

```{r}
#step 2 for interaction tea
# Load libraries
library(lme4)
library(lmerTest)  # Provides p-values for fixed effects
library(dplyr)

# Load the dataset (replace 'your_dataset.csv' with your actual dataset)
df <- read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')

# List of required columns for the analysis
required_columns_tea <- c("rsfMRI_Component4", "rsfMRI_Component7", "rsfMRI_Component8", "rsfMRI_Component11", "rsfMRI_Component14", 
                          "rsfMRI_Component21", "rsfMRI_Component12", "Assessment_0", "APOE_all", 
                          "T40_Gcar", "family_history_AD", "Age_Baseline", "Sex", "SmokingY08", 
                          "AlcoholY08", "BMI_Y08andY12andY14_mean", "Townsend", "StandTea_mean")

# Ensure that the required columns exist in the dataset
missing_columns <- setdiff(required_columns_tea, colnames(df))
if (length(missing_columns) > 0) {
    stop(paste("The following required columns are missing from the dataset:", paste(missing_columns, collapse = ", ")))
}

# Create a complete dataset by removing rows with NA in the required columns
df <- df[complete.cases(df[, required_columns_tea]), ]

# Ensure that factors are treated correctly
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Assessment_0 <- as.factor(df$Assessment_0)  # For random effects

DataSet1_APOE0 <- subset(df, APOE_all == 0)

# Check the levels of each factor variable (particularly those involved in the model)
table(DataSet1_APOE0$Sex)
table(DataSet1_APOE0$family_history_AD)
table(DataSet1_APOE0$T40_Gcar)

model_APOE0 <- lmer(rsfMRI_Component7 ~ StandTea_mean + T40_Gcar + family_history_AD + Age_Baseline +
                    Sex + SmokingY08 + AlcoholY08 + BMI_Y08andY12andY14_mean + Townsend + 
                    (1 | Assessment_0), data = DataSet1_APOE0, REML=FALSE)

# View summary for APOE_all = 0
summary(model_APOE0)



# List of rsfMRI components to loop through
rsfMRI_components <- c("rsfMRI_Component4", "rsfMRI_Component7", "rsfMRI_Component8", "rsfMRI_Component11", "rsfMRI_Component14", 
                       "rsfMRI_Component21", "rsfMRI_Component12")

# Initialize an empty data frame to store results
all_results_df <- data.frame()

### Loop 1: Testing by family_history_AD ###
for (component in rsfMRI_components) {
    # Check if the component exists in the dataset
    if (!component %in% colnames(df)) {
        warning(paste("Component", component, "is missing in the dataset. Skipping this component."))
        next
    }
  
    # Dynamically update the formula for each component
    formula <- as.formula(paste(component, "~ StandTea_mean + (1 | Assessment_0)"))

    # Loop over family_history_AD
    for (family_history in unique(df$family_history_AD)) {
        # Subset the data for the current family_history_AD
        df_subset <- subset(df, family_history_AD == family_history)
        
        if (nrow(df_subset) > 0) {
            # Fit the mixed model
            model <- lmer(formula, data = df_subset, REML = FALSE)  # Use ML method
            summary_model <- summary(model)$coefficients
        } else {
            summary_model <- data.frame(Estimate = NA, `Std. Error` = NA, `Pr(>|t|)` = NA)
        }

        # Filter for "StandTea_mean" term only (exclude intercept)
        summary_model <- summary_model[rownames(summary_model) == "StandTea_mean", , drop = FALSE]

        # Create a data frame to store results for the current family_history_AD
        results_df <- data.frame(
            rsfMRI_Component = rep(component, nrow(summary_model)),
            Variable = "family_history_AD",
            Group = rep(family_history, nrow(summary_model)),
            Term = rownames(summary_model),
            Estimate = summary_model[, "Estimate"],
            Std_Error = summary_model[, "Std. Error"],
            p_value = summary_model[, "Pr(>|t|)"]
        )

        # Combine the current results with the overall results
        all_results_df <- rbind(all_results_df, results_df)
    }
}

### Loop 2: Testing by APOE_all ###
for (component in rsfMRI_components) {
    # Check if the component exists in the dataset
    if (!component %in% colnames(df)) {
        warning(paste("Component", component, "is missing in the dataset. Skipping this component."))
        next
    }
  
    # Dynamically update the formula for each component
    formula <- as.formula(paste(component, "~ StandTea_mean + (1 | Assessment_0)"))

    # Loop over APOE_all
    for (APOE in unique(df$APOE_all)) {
        # Subset the data for the current APOE_all
        df_subset <- subset(df, APOE_all == APOE)
        
        if (nrow(df_subset) > 0) {
            # Fit the mixed model
            model <- lmer(formula, data = df_subset, REML = FALSE)  # Use ML method
            summary_model <- summary(model)$coefficients
        } else {
            summary_model <- data.frame(Estimate = NA, `Std. Error` = NA, `Pr(>|t|)` = NA)
        }

        # Filter for "StandTea_mean" term only (exclude intercept)
        summary_model <- summary_model[rownames(summary_model) == "StandTea_mean", , drop = FALSE]

        # Create a data frame to store results for the current APOE_all
        results_df <- data.frame(
            rsfMRI_Component = rep(component, nrow(summary_model)),
            Variable = "APOE_all",
            Group = rep(APOE, nrow(summary_model)),
            Term = rownames(summary_model),
            Estimate = summary_model[, "Estimate"],
            Std_Error = summary_model[, "Std. Error"],
            p_value = summary_model[, "Pr(>|t|)"]
        )

        # Combine the current results with the overall results
        all_results_df <- rbind(all_results_df, results_df)
    }
}

# Write the combined results to a CSV file
write.csv(all_results_df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\tea_coffee\\interactions_Tea_all_components.csv", 
          na = '', row.names = FALSE)
rm(list = ls())
```

```{r}
#Mancova
install.packages("car")
library(car)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\tea_coffee.csv')
# Example with dependent variables as neural networks (Z-scores)
mancova_model <- manova(cbind(rsfMRI_Component4, rsfMRI_Component7, rsfMRI_Component18, rsfMRI_Component11, rsfMRI_Component12, rsfMRI_Component14, rsfMRI_Component21) ~ FilterCoffee_mean + GreenTea_mean +  StandTea_mean+ SmokingY08 + AlcoholY08 + BMI_Y08andY12andY14_mean + Townsend, data = df)



# Check omnibus test results
summary(mancova_model, test = "Wilks")
```

